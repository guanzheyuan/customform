function saveLayout() {
    return;
    $.ajax({
        type: "POST",
        url: "/build_v3/saveLayout",
        data: {
            'layout-v3': $('.demo').html()
        },
        success: function (data) {
            console.log(data);
        }
    });
}
function saveLayout() {
    return;
    $.ajax({
        type: "POST",
        url: "/build_v3/saveLayout",
        data: {
            'layout-v3': $('.demo').html()
        },
        success: function (data) {
            console.log(data);
            //updateButtonsVisibility();
        }
    });
}

//下载代码
function downloadLayout() {
    $.ajax({
        type: "POST",
        url: "/build_v3/downloadLayout",
        data: {
            'layout-v3': $('#download-layout').html()
        },
        success: function (data) {
            window.location.href = '/build_v3/download';
        }
    });
}

function downloadHtmlLayout() {
    $.ajax({
        type: "POST",
        url: "/build_v3/downloadLayout",
        data: {
            'layout-v3': $('#download-layout').html()
        },
        success: function (data) {
            window.location.href = '/build_v3/downloadHtml';
        }
    });
}

function undoLayout() {

    $.ajax({
        type: "POST",
        url: "/build_v3/getPreviousLayout",
        data: {},
        success: function (data) {
            undoOperation(data);
        }
    });
}

function redoLayout() {

    $.ajax({
        type: "POST",
        url: "/build_v3/getPreviousLayout",
        data: {},
        success: function (data) {
            redoOperation(data);
        }
    });
}

$(document).on('hidden.bs.modal', function (e) {
    $(e.target).removeData('bs.modal');
});

$('body').on('click', '#continue-share-non-logged', function () {
    $('#share-not-logged').hide();
    $('#share-logged').removeClass('hide');
    $('#share-logged').show();
});

$('body').on('click', '#continue-download-non-logged', function () {
    $('#download-not-logged').hide();
    $('#download').removeClass('hide');
    $('#download').show();
    $('#downloadhtml').removeClass('hide');
    $('#downloadhtml').show();
    $('#download-logged').removeClass('hide');
    $('#download-logged').show();
});
function handleSaveLayout() {
    var e = $(".demo").html();
    if (e != window.demoHtml) {
        saveLayout();
        window.demoHtml = e
    }
}

function handleJsIds() {
    handleModalIds();
    handleAccordionIds();
    handleCarouselIds();
    handleTabsIds()
}

function handleAccordionIds() {
    var e = $(".demo #myAccordion");
    var t = randomNumber();
    var n = "panel-" + t;
    var r;
    e.attr("id", n);
    e.find(".panel").each(function (e, t) {
        r = "panel-element-" + randomNumber();
        $(t).find(".panel-title").each(function (e, t) {
            $(t).attr("data-parent", "#" + n);
            $(t).attr("href", "#" + r)
        });
        $(t).find(".panel-collapse").each(function (e, t) {
            $(t).attr("id", r)
        })
    })
}

function handleCarouselIds() {
    var e = $(".demo #myCarousel");
    var t = randomNumber();
    var n = "carousel-" + t;
    e.attr("id", n);
    e.find(".carousel-indicators li").each(function (e, t) {
        $(t).attr("data-target", "#" + n)
    });
    e.find(".left").attr("href", "#" + n);
    e.find(".right").attr("href", "#" + n)
}

function handleModalIds() {
    var e = $(".demo #myModalLink");
    var t = randomNumber();
    var n = "modal-container-" + t;
    var r = "modal-" + t;
    e.attr("id", r);
    e.attr("href", "#" + n);
    e.next().attr("id", n)
}

function handleTabsIds() {
    var e = $(".demo #myTabs");
    var t = randomNumber();
    var n = "tabs-" + t;
    e.attr("id", n);
    e.find(".tab-pane").each(function (e, t) {
        var n = $(t).attr("id");
        var r = "panel-" + randomNumber();
        $(t).attr("id", r);
        $(t).parent().parent().find("a[href=#" + n + "]").attr("href", "#" + r)
    })
}

function randomNumber() {
    return randomFromInterval(1, 1e6)
}

function randomFromInterval(e, t) {
    return Math.floor(Math.random() * (t - e + 1) + e)
}

function gridSystemGenerator() {
    $(".lyrow .preview input").bind("keyup", function () {
        var e = 0;
        var t = "";
        var n = false;
        var r = $(this).val().split(" ", 12);
        $.each(r, function (r, i) {
            if (!n) {
                if (parseInt(i) <= 0) n = true;
                e = e + parseInt(i);
                t += '<div class="col-md-' + i + ' column"></div>'
            }
        });
        if (e == 12 && !n) {
            $(this).parent().next().children().html(t);
            $(this).parent().prev().show()
        } else {
            $(this).parent().prev().hide()
        }
    })
}

function configurationElm(e, t) {
    $(".demo").delegate(".configuration > a", "click", function (e) {
        e.preventDefault();
        var t = $(this).parent().next().next().children();
        $(this).toggleClass("active");
        t.toggleClass($(this).attr("rel"))
    });
    $(".demo").delegate(".configuration .dropdown-menu a", "click", function (e) {
        e.preventDefault();
        var t = $(this).parent().parent();
        var n = t.parent().parent().next().next().children();
        t.find("li").removeClass("active");
        $(this).parent().addClass("active");
        var r = "";
        t.find("a").each(function () {
            r += $(this).attr("rel") + " "
        });
        t.parent().removeClass("open");
        n.removeClass(r);
        n.addClass($(this).attr("rel"))
    })
}

function removeElm() {
    $(".demo").delegate(".remove2", "click", function (e) {
        e.preventDefault();
        $(this).parent().remove();
        if (!$(".demo .lyrow").length > 0) {
            clearDemo()
        }
        var $demo = $(".demo");
        var optionHtml='<option value=" ">请选择</option>';
        var optionMap;
        var labelArr = [];
        var $demo = $(".demo");
        $demo.find('label').each(function(e){
            if(undefined != $(this).attr('id') && undefined != $(this).attr('title')){
                optionMap = {value:'',text:''};
                optionHtml +='<option value="'+$(this).attr('id')+'" >'+$(this).attr('title')+'</option>';
                optionMap.value = $(this).attr('id');
                optionMap.text = $(this).attr('title');
                labelArr.push(optionMap);
            }
        });
        window.labelArr = labelArr;
        $("#editorInputModal select[name=orgname]").html(optionHtml);
        $("#editorSelectModal select[name=orgname]").html(optionHtml);
        $("#editorTextareaModal select[name=orgname]").html(optionHtml);
        $("#editorRadioModal select[name=orgname]").html(optionHtml);
        $("#editorCheckboxModal select[name=orgname]").html(optionHtml);
        $("#editorDateTimeModal select[name=orgname]").html(optionHtml);
    });
}

function clearDemo() {
    $(".demo").empty()
}

function removeMenuClasses() {
    $("#menu-layoutit li button").removeClass("active");
    $(".sidebar-nav-right").hide();
}

function changeStructure(e, t) {
    $("#download-layout ." + e).removeClass(e).addClass(t)
}

function cleanHtml(e) {
    $(e).parent().append($(e).children().html())
}
var layoutHtml;
function downloadLayoutSrc() {
    
    layoutHtml = $(".container").html();
}
function strimgTurnDom(txt){
	try 
    {
     xmlDoc=new ActiveXObject("Microsoft.HTMLDOM");
     xmlDoc.async="false";
     xmlDoc.loadXML(txt);
     alert("ie");
     return(xmlDoc);
    }
  catch(e)
    {
        try //Firefox, Mozilla, Opera, etc.
          {
            parser=new DOMParser();
            xmlDoc=parser.parseFromString(txt,"text/html");
            return(xmlDoc);
          }
        catch(e) {alert(e.message)}
    }
  return(null);
}
function loadUEditor(id){
    var formEditor = UE.getEditor(id, {
        toolleipi: true,//是否显示，设计器的 toolbars
        textarea: id,
        initialFrameHeight:300,
        elementPathEnabled:false,
        //这里可以选择自己需要的工具按钮名称,此处仅选择如下五个
        toolbars: [[
            'fullscreen',
            'source', '|',
            'undo',
            'redo', '|',
            'bold',
            'italic',
            'underline',
            'fontborder',
            'strikethrough',
            'removeformat', '|',
            'forecolor',
            'backcolor',
            'insertorderedlist',
            'insertunorderedlist', '|',
            'fontfamily',
            'fontsize', '|',
            'indent', '|',
            'justifyleft',
            'justifycenter',
            'justifyright',
            'justifyjustify', '|',
            'link', 'unlink', '|',
            'horizontal',
            'spechars',
            'insertimage', '|',
            'inserttable',
            'deletetable',
            'mergecells',
            'splittocells'
        ]],
    });
}
function loadJson(){
        console.log(layoutHtml);
        var allDom = strimgTurnDom(layoutHtml).querySelectorAll('.getdom');
        var fromEle = {
			formId:1,
            formName:'test_1',
            type: "antd",
			formElements:[]
        }
        var formInputElements;
        var formSelectElements;
        var formTextareaElements;
        var formRadioElements;
        var formCheckBoxElements;
        var formTimeElements;
        for(var i=0;i<allDom.length;i++){
            //输入框组合
            if(allDom[i].type == "text"){
                formInputElements = {
                    eleType:'',
                    labelGridCol:0,
                    name:'',
                    label:'',
                    contentGridCol:0,
                    value:'',
                    content:'',
                    required:'',
                }
                formInputElements.eleType = 'Input';
                formInputElements.name = allDom[i].attributes.name == undefined ?'':allDom[i].attributes.name.value;
                formInputElements.required = allDom[i].attributes.isrequired == undefined?'':allDom[i].attributes.isrequired.value == 'Y';
                formInputElements.value = allDom[i].attributes.value ==undefined?'':allDom[i].attributes.value.value;
                if(12 == allDom[i].attributes.col.value){
                    formInputElements.contentGridCol = allDom[i].attributes.col == undefined?'':20; 
                }else if(6 == allDom[i].attributes.col.value){
                    formInputElements.contentGridCol = allDom[i].attributes.col == undefined?'':8; 
                }else{
                    formInputElements.contentGridCol = allDom[i].attributes.col == undefined?'':allDom[i].attributes.col.value; 
                }
                formInputElements.label = allDom[i].attributes.orgname;
                formInputElements.labelGridCol = 4;
                fromEle.formElements.push(formInputElements);
            }
            //下拉框
            if(allDom[i].type == "select-one"){
                formSelectElements = {
                    eleType:'',
                    labelGridCol:0,
                    name:'',
                    label:'',
                    contentGridCol:0,
                    value:'',
                    content:'',
                    required:'',
                    eleInfo:[]
                }
                formSelectElements.eleType = 'Select';
                formSelectElements.name = allDom[i].attributes.name == undefined ?'':allDom[i].attributes.name.value;
                formSelectElements.required = allDom[i].attributes.isrequired == undefined?'':allDom[i].attributes.isrequired.value == 'Y';
                formSelectElements.value = allDom[i].attributes.value ==undefined?'':allDom[i].attributes.value.value;
                if(12 == allDom[i].attributes.col.value){
                    formSelectElements.contentGridCol = allDom[i].attributes.col == undefined?'':20; 
                }else if(6 == allDom[i].attributes.col.value){
                    formSelectElements.contentGridCol = allDom[i].attributes.col == undefined?'':8; 
                }else{
                    formSelectElements.contentGridCol = allDom[i].attributes.col == undefined?'':allDom[i].attributes.col.value;
                }
                formSelectElements.label = allDom[i].attributes.orgname;
                formSelectElements.labelGridCol = 4;
                if(allDom[i].options.length > 0){
                    var option;
                    var eleInfo;
                    for(var j = 0;j<allDom[i].options.length;j++){
                        eleInfo  = {
                            value:'',
                            content:''
                        }
                        option = allDom[i].options[j];
                        eleInfo.value = option.value;
                        eleInfo.content = option.text;
                        formSelectElements.eleInfo.push(eleInfo);
                    }
                }
                fromEle.formElements.push(formSelectElements)
            }
            //文本框
            if(allDom[i].type == "textarea"){
                formTextareaElements = {
                    eleType:'',
                    labelGridCol:0,
                    name:'',
                    label:'',
                    contentGridCol:0,
                    value:'',
                    content:'',
                    required:'',
                }
                formTextareaElements.eleType = 'Textarea';
                formTextareaElements.name = allDom[i].attributes.name == undefined ?'':allDom[i].attributes.name.value;
                formTextareaElements.value = allDom[i].attributes.value ==undefined?'':allDom[i].attributes.value.value;
                formTextareaElements.required = allDom[i].attributes.isrequired == undefined?'':allDom[i].attributes.isrequired.value == 'Y';
                if(12 == allDom[i].attributes.col.value){
                    formTextareaElements.contentGridCol = allDom[i].attributes.col == undefined?'':20; 
                }else if(6 == allDom[i].attributes.col.value){
                    formTextareaElements.contentGridCol = allDom[i].attributes.col == undefined?'':8; 
                }else{
                    formTextareaElements.contentGridCol = allDom[i].attributes.col == undefined?'':allDom[i].attributes.col.value;
                }
                formTextareaElements.label = allDom[i].attributes.orgname;
                formTextareaElements.labelGridCol = 4;
                fromEle.formElements.push(formTextareaElements);
            }
            //redio
            if(allDom[i].type == "radio" ){
                formRadioElements = {
                    eleType:'',
                    labelGridCol:0,
                    name:'',
                    label:'',
                    contentGridCol:0,
                    value:'',
                    content:'',
                    required:''
                }
                formRadioElements.eleType = 'radio';
                formRadioElements.name = allDom[i].attributes.name == undefined ?'':allDom[i].attributes.name.value;
                //formRadioElements.label = allDom[i].attributes.title == undefined?'':allDom[i].attributes.title.value;
                //formRadioElements.value = allDom[i].attributes.value ==undefined?'':allDom[i].attributes.value.value;
                formRadioElements.required = allDom[i].attributes.isrequired == undefined?'':allDom[i].attributes.isrequired.value == 'Y';
                if(12 == allDom[i].attributes.col.value){
                    formRadioElements.contentGridCol = allDom[i].attributes.col == undefined?'':20; 
                }else if(6 == allDom[i].attributes.col.value){
                    formRadioElements.contentGridCol = allDom[i].attributes.col == undefined?'':8; 
                }else{
                    formRadioElements.contentGridCol = allDom[i].attributes.col == undefined?'':allDom[i].attributes.col.value;
                }
                formRadioElements.label = allDom[i].attributes.orgname;
                formRadioElements.labelGridCol = 4;
                fromEle.formElements.push(formRadioElements);
            }
            //checkbox
            if(allDom[i].type == "checkbox"){
                formCheckBoxElements = {
                    eleType:'',
                    labelGridCol:0,
                    name:'',
                    label:'',
                    contentGridCol:0,
                    value:'',
                    content:'',
                    required:''
                }
                formCheckBoxElements.eleType = 'checkbox';
                formCheckBoxElements.name = allDom[i].attributes.name == undefined ?'':allDom[i].attributes.name.value;
                //formCheckBoxElements.label = allDom[i].attributes.title == undefined?'':allDom[i].attributes.title.value;
                formCheckBoxElements.value = allDom[i].attributes.value ==undefined?'':allDom[i].attributes.value.value;
                formCheckBoxElements.required = allDom[i].attributes.isrequired == undefined?'':allDom[i].attributes.isrequired.value == 'Y';
                if(12 == allDom[i].attributes.col.value){
                    formCheckBoxElements.contentGridCol = allDom[i].attributes.col == undefined?'':20; 
                }else if(6 == allDom[i].attributes.col.value){
                    formCheckBoxElements.contentGridCol = allDom[i].attributes.col == undefined?'':8; 
                }else{
                    formCheckBoxElements.contentGridCol = allDom[i].attributes.col == undefined?'':allDom[i].attributes.col.value;
                }
                formCheckBoxElements.label = allDom[i].attributes.orgname;
                formCheckBoxElements.labelGridCol = 4;
                fromEle.formElements.push(formCheckBoxElements);
            }
            //data
            if(allDom[i].type == "date"){
                formTimeElements = {
                    eleType:'',
                    labelGridCol:0,
                    name:'',
                    label:'',
                    contentGridCol:0,
                    value:'',
                    content:'',
                    required:''
                }
                formTimeElements.eleType = allDom[i].attributes.type.value;
                formTimeElements.name = allDom[i].attributes.name == undefined ?'':allDom[i].attributes.name.value;
                //formTimeElements.label = allDom[i].attributes.title == undefined?'':allDom[i].attributes.title.value;
                formTimeElements.value = allDom[i].attributes.value ==undefined?'':allDom[i].attributes.value.value;
                formTimeElements.required = allDom[i].attributes.isrequired == undefined?'':allDom[i].attributes.isrequired.value == 'Y';
                //formTimeElements.labelGridCol = allDom[i].attributes.labelcol == undefined?'':allDom[i].attributes.labelcol.value;
                if(12 == allDom[i].attributes.col.value){
                    formTimeElements.contentGridCol = allDom[i].attributes.col == undefined?'':20; 
                }else if(6 == allDom[i].attributes.col.value){
                    formTimeElements.contentGridCol = allDom[i].attributes.col == undefined?'':8; 
                }else{
                    formTimeElements.contentGridCol = allDom[i].attributes.col == undefined?'':allDom[i].attributes.col.value;
                }
                formTimeElements.label = allDom[i].attributes.orgname;
                formTimeElements.labelGridCol = 4;
                fromEle.formElements.push(formTimeElements);
            }
        }
        if(fromEle.formElements.length > 0 ){
            window.toJson = fromEle;
			$("#toJsonModal textarea").val(formatJson(fromEle));
		}
}
function formatJson(json, options) {
    var reg = null,
        formatted = '',
        pad = 0,
        PADDING = '    '; 
    options = options || {};
    options.newlineAfterColonIfBeforeBraceOrBracket = (options.newlineAfterColonIfBeforeBraceOrBracket === true) ? true : false;
    options.spaceAfterColon = (options.spaceAfterColon === false) ? false : true;
    if (typeof json !== 'string') {
        json = JSON.stringify(json);
    }
    json = JSON.parse(json);
    json = JSON.stringify(json);
    reg = /([\{\}])/g;
    json = json.replace(reg, '\r\n$1\r\n');
    reg = /([\[\]])/g;
    json = json.replace(reg, '\r\n$1\r\n');
    reg = /(\,)/g;
    json = json.replace(reg, '$1\r\n');
    reg = /(\r\n\r\n)/g;
    json = json.replace(reg, '\r\n');
    reg = /\r\n\,/g;
    json = json.replace(reg, ',');
    if (!options.newlineAfterColonIfBeforeBraceOrBracket) {
        reg = /\:\r\n\{/g;
        json = json.replace(reg, ':{');
        reg = /\:\r\n\[/g;
        json = json.replace(reg, ':[');
    }
    if (options.spaceAfterColon) {
        reg = /\:/g;
        json = json.replace(reg, ': ');
    }
    $.each(json.split('\r\n'), function(index, node) {
        var i = 0,
            indent = 0,
            padding = '';
        if (node.match(/\{$/) || node.match(/\[$/)) {
            indent = 1;
        } else if (node.match(/\}/) || node.match(/\]/)) {
            if (pad !== 0) {
                pad -= 1;
            }
        } else {
            indent = 0;
        }

        for (i = 0; i < pad; i++) {
            padding += PADDING;
        }

        formatted += padding + node + '\r\n';
        pad += indent;
    });
    return formatted;
};
function UEditorAddListener(id){
    UE.getEditor(id).addListener("click", function (type, event) {
        window.UEditorId = UE.getEditor(id).key;
        window.UEditor = UE.getEditor(id);
        window.domClick = event;
        if('text' == $(event.target).attr('type')){
            window.isUEditor = true;
            $('#editorInputTableModal').modal('show');
            $("#editorInputTableModal input[name=fieldname]").val($(event.target).attr("fieldname"));
            $("#editorInputTableModal input[name=orgname]").val($(event.target).attr("orgname"));
			$("#editorInputTableModal input[name=orgvalue]").val($(event.target).attr("value"));
            $("#editorInputTableModal .isRequired").find("option[value='"+$(event.target).attr("isRequired")+"']").prop("selected",true);
            $("#editorInputTableModal .orgtype").find("option[value='"+$(event.target).attr("orgtype")+"']").prop("selected",true);
        }else if('select' == $(event.target).attr('type')){
            window.isUEditor = true;
            $('#editorSelectTableModal').modal('show');
            $("#editorSelectTableModal input[name=fieldname]").val($(event.target).attr('fieldname'));
            $("#editorSelectTableModal input[name=orgname]").val($(event.target).attr('orgname'));
            $("#editorSelectTableModal .isRequired").find("option[value='"+$(event.target).attr('isRequired')+"']").prop("selected",true);
			var optionHtml = ' ';
            var index = 0;
            console.log($(event.target));
			$($(event.target)).find("option").each(function(){
				optionHtml += '<tr id="'+index+'"><td>'+$(this).eq(0).html()+'</td><td>'+$(this).eq(0).val()+'</td><td><button type="button" class="btn btn-danger btn-xs removeTr" >删除</button></td></tr>';
				index++;
			});
			$("#editorSelectTableModal table tbody").html(optionHtml);
        }else if('textarea' == $(event.target).attr('type')){
            window.isUEditor = true;
            $('#editorTextareaTableModal').modal('show');
            $("#editorTextareaTableModal input[name=fieldname]").val($(event.target).attr('fieldname'));
            $("#editorTextareaTableModal input[name=orgname]").val($(event.target).attr('orgname'));
             $("#editorTextareaTableModal .isRequired").find("option").prop("selected",false);
             $("#editorTextareaTableModal .isRequired").find("option[value='"+$(event.target).attr('isRequired')+"']").prop("selected",true);
        }else if('radio' == $(event.target).attr('type')){
            window.isUEditor = true;
            $('#editorRadioTableModal').modal('show');
            $("#editorRadioTableModal input[name=fieldname]").val($(event.target).attr('name'));
            $("#editorRadioTableModal input[name=orgname]").val($(event.target).attr('title'));
			var index = 0;
			var isReq = '';
			var html = '';
			var isReqText = '';
			$($(event.target).parent()).find("label").each(function(){
				if(''!=$(this).eq(0).html() && ''!=$(this).eq(0).next().val() && ''!=$(this).eq(0).next().attr("checked")){
                    var isChecked = $(this).eq(0).next().attr("checked");
					if('checked' == isChecked){
						isReq = 'Y';
						isReqText = '是';
					}else{
						isReq = 'N';
						isReqText = '否';
					}
					html += '<tr id="'+index+'"><td>'+$(this).eq(0).html()+'</td><td>'+$(this).eq(0).prev().val()+'</td><td value='+isReq+'>'+isReqText+'</td><td><button type="button" class="btn btn-danger btn-xs removeTr" >删除</button></td></tr>';
					index++;
				}
			});
			$("#editorRadioTableModal table tbody").html(html);
        }else if('checkbox' == $(event.target).attr('type')){
            window.isUEditor = true;
            $('#editorCheckboxTableModal').modal('show');
            $("#editorCheckboxTableModal input[name=fieldname]").val($(event.target).attr('name'));
            $("#editorCheckboxTableModal input[name=orgname]").val($(event.target).attr('title'));
			var index = 0;
			var isReq = '';
			var html = '';
			var isReqText = '';
			$($(event.target).parent()).find("label").each(function(){
				if(''!=$(this).eq(0).html() && ''!=$(this).eq(0).next().val() && ''!=$(this).eq(0).next().attr("checked")){
					var isChecked = $(this).eq(0).next().attr("checked");
					if('checked' == isChecked){
						isReq = 'Y';
						isReqText = '是';
					}else{
						isReq = 'N';
						isReqText = '否';
					}
					html += '<tr id="'+index+'"><td>'+$(this).eq(0).html()+'</td><td>'+$(this).eq(0).prev().val()+'</td><td value='+isReq+'>'+isReqText+'</td><td><button type="button" class="btn btn-danger btn-xs removeTr" >删除</button></td></tr>';
					index++;
				}
			});
			$("#editorCheckboxTableModal table tbody").html(html);
        }else if('date,time,datetime-local,month,week'.indexOf($(event.target).attr('type'))!=-1){
            window.isUEditor = true;
            $('#editorDateTimeTableModal').modal('show');
            $("#editorDateTimeTableModal input[name=fieldname]").val($(event.target).attr('name'));
            $("#editorDateTimeTableModal input[name=orgname]").val($(event.target).attr('title'));
            $("#editorDateTimeTableModal .isRequired").find("option").prop("selected",false);
            $("#editorDateTimeTableModal .isRequired").find("option[value='"+$(event.target).attr('isRequired')+"']").prop("selected",true);
            $("#editorDateTimeTableModal .type").find("option[value='"+$(event.target).attr('type')+"']").prop("selected",true);
        }
        else{
            window.isUEditor = false;
        }
     });
}
//属性回显事件
var isLayoutClick = true;
var prevViewDom;
function clickFix(obj){
   if($(obj).parent().find(".editElement").length > 0){
        var element = $(obj).find(".view").children().children();
        var dataType = $(element).attr("type");
        
        if(undefined == dataType){
            element = $(obj).find(".view").children().children().next();
            dataType = $(element).attr("type");
            if(undefined == dataType){
                element = $(obj).find(".view").children().children().next().next();
                dataType = $(element).attr("type");
                if(undefined == dataType){
                    element = $(obj).find(".view").children().children().next().next().children();
                    dataType = $(element).attr("type");
                }
            }
        }
        if('grid-layout' == dataType && isLayoutClick){
            window.selectDom = element;
            window.selectDomId = $($(element).parent()[3]).attr("id");
            $("#editorLayout").removeClass('hide');
            $("#editorInputModal_").addClass("hide");
            $("#editorSelectModal_").addClass('hide');
            $("#editorTexareaModal_").addClass('hide');
            $("#editorRadioModal_").addClass('hide');
            isLayoutClick = true;
            var className = $(element).attr('class');
            var index = className.split(' ')[0].split('-')[2];
            if(12 == index){
                $("#editorLayout select[name=layoutCol]").find("option[value=1]").prop("selected",true);
            }else if(6 == index){
                $("#editorLayout select[name=layoutCol]").find("option[value=2]").prop("selected",true);
            }else if(4 == index){
                $("#editorLayout select[name=layoutCol]").find("option[value=3]").prop("selected",true);
            }else if(3 == index){
                $("#editorLayout select[name=layoutCol]").find("option[value=4]").prop("selected",true);
            }
            //去除上一次点击边框效果
            if(prevViewDom){
                prevViewDom.removeClass("borderActive");
                prevViewDom.addClass("borderNoActive");
                prevViewDom.children().eq(1).addClass("hide");
            }
            //点击加载边框线效果
            $(obj).find(".view").eq(0).addClass("borderActive");
            $(obj).find(".view").eq(0).removeClass("borderNoActive");
            $(obj).find(".view").eq(0).children().removeClass("hide");
            prevViewDom = $(obj).find(".view").eq(0);
        }else if('text' == dataType){
            $("#editorLayout").addClass('hide');
            $("#editorInputModal_").removeClass("hide");
            $("#editorSelectModal_").addClass('hide');
            $("#editorTexareaModal_").addClass('hide');
            $("#editorRadioModal_").addClass('hide');
            $("#editorCheckBoxModal_").addClass('hide');
            $("#editorDateTimeModal_").addClass('hide');
            //处理回显
            $("#editorInputModal_ .orgname").val($(element).attr('orgname'));
            $("#editorInputModal_ .fieldname").val($(element).attr('fieldname'));
            $("#editorInputModal_ .orgvalue").val($(element).attr('value'));
            $("#editorInputModal_ select[name=isRequired]").find("option[value='"+$(element).attr('isRequired')+"']").prop("selected",true);
            $("#editorInputModal_ select[name=orgtype]").find("option[value='"+$(element).attr('orgtype')+"']").prop("selected",true);
            $("#editorInputModal_ .placeholder").val($(element).attr('placeholder'));
            window.inputDom = element;
            isLayoutClick  = false;
            renderBorder(obj)
        }else if('select' == dataType){
            $("#editorSelectModal_").removeClass('hide');
            $("#editorInputModal_").addClass("hide");
            $("#editorLayout").addClass('hide');
            $("#editorTexareaModal_").addClass('hide');
            $("#editorRadioModal_").addClass('hide');
            $("#editorCheckBoxModal_").addClass('hide');
            $("#editorDateTimeModal_").addClass('hide');
            //处理回显
            $("#editorSelectModal_ .orgname").val($(element).attr('orgname'));
            $("#editorSelectModal_ .fieldname").val($(element).attr('fieldname'));
            $("#editorSelectModal_ select[name=isRequired]").find("option[value='"+$(element).attr('isRequired')+"']").prop("selected",true);
            var selHtml = $(element).find('option');
            var html = '';
            $("#editorSelectModal_ .addSelectOption").html(html);
            if(selHtml.length > 0){
                for(var i = 0;i<selHtml.length ;i++){
                    html += '<div style="display:flex;padding-bottom:5px;">&nbsp;&nbsp;<div class="checkbox checkSelectOption" ><label> <input type="checkbox"style="zoom:140%;" checked="checked"></label></div><input type="text" name="valueName" value="'+$(selHtml[i]).text()+'" autocomplete="off" class="form-control " placeholder="名称" style="width:30%;">&nbsp;&nbsp;<input type="text" value="'+$(selHtml[i]).val()+'" name="value" autocomplete="off" class="form-control " placeholder="值" style="width:30%;"><div style="padding-top:10px;padding-left:10px;cursor:pointer" onClick="removeSelectOption(this)" ><i class="glyphicon-trash glyphicon"></i></div></div>';
                }
                $("#editorSelectModal_ .addSelectOption").html(html);
            }
            console.log(dataType);
            window.selectDom_ = element;
            isLayoutClick  = false;
            renderBorder(obj)
        }else if('textarea' == dataType){
            $("#editorSelectModal_").addClass('hide');
            $("#editorInputModal_").addClass("hide");
            $("#editorLayout").addClass('hide');
            $("#editorRadioModal_").addClass('hide');
            $("#editorTexareaModal_").removeClass('hide');
            $("#editorCheckBoxModal_").addClass('hide')
            $("#editorDateTimeModal_").addClass('hide');
            //处理回显
            $("#editorTexareaModal_ .orgname").val($(element).attr('orgname'));
            $("#editorTexareaModal_ .fieldname").val($(element).attr('fieldname'));
            $("#editorTexareaModal_ select[name=isRequired]").find("option[value='"+$(element).attr('isRequired')+"']").prop("selected",true);
            window.textareaDom_ = element;
            isLayoutClick  = false;
            renderBorder(obj)
        }else if('radio' == dataType){
            $("#editorSelectModal_").addClass('hide');
            $("#editorInputModal_").addClass("hide");
            $("#editorLayout").addClass('hide');
            $("#editorTexareaModal_").addClass('hide');
            $("#editorRadioModal_").removeClass('hide');
            $("#editorCheckBoxModal_").addClass('hide')
            $("#editorDateTimeModal_").addClass('hide');
            //处理回显
            $("#editorRadioModal_ .orgname").val($(element).attr('orgname'));
            $("#editorRadioModal_ .fieldname").val($(element).attr('fieldname'));
            $("#editorRadioModal_ .addRadioOption").html('');
            var $inputE = element.parent().children();
            if($inputE.length > 0){
                var html = '';
                for(var i =0;i<$inputE.length;i++){
                    if('radio' == $($inputE[i]).attr('type')){
                        if(undefined != $($inputE[i]).attr('label')){
                            html='<div style="display:flex;padding-bottom:5px;options">&nbsp;&nbsp;<div class="checkbox checkRadioOption" ><label> <input type="checkbox" checked="checked" class="radiobox" style="zoom:140%;"></label></div><input type="text" name="valueName" autocomplete="off" class="form-control " placeholder="名称" value="'+$($inputE[i]).attr('label')+'" style="width:30%;">&nbsp;&nbsp;<input type="text" name="value" autocomplete="off" class="form-control " placeholder="值" value="'+$($inputE[i]).val()+'" style="width:30%;"><div style="padding-top:10px;padding-left:10px;cursor:pointer" onClick="removeSelectOption(this)" ><i class="glyphicon-trash glyphicon"></i></div></div>';
                            $("#editorRadioModal_  .addRadioOption").append(html);
                        }
                    }
                }
               
            }
            window.radioDom_ = element;
            window.radioParentDom = element.parent();
            isLayoutClick  = false;
            renderBorder(obj)
        }else if('checkbox' == dataType){
            $("#editorSelectModal_").addClass('hide');
            $("#editorInputModal_").addClass("hide");
            $("#editorLayout").addClass('hide');
            $("#editorTexareaModal_").addClass('hide');
            $("#editorRadioModal_").addClass('hide');
            $("#editorCheckBoxModal_").removeClass('hide');
            $("#editorDateTimeModal_").addClass('hide');
             //处理回显
            $("#editorCheckBoxModal_ .orgname").val($(element).attr('orgname'));
            $("#editorCheckBoxModal_ .fieldname").val($(element).attr('fieldname'));
            var $inputE = element.parent().children();
            $("#editorCheckBoxModal_ .addCheckboxOption").html('');
            if($inputE.length > 0){
                var html = '';
                for(var i =0;i<$inputE.length;i++){
                    if('checkbox' == $($inputE[i]).attr('type')){
                        if(undefined != $($inputE[i]).attr('label')){
                            html='<div style="display:flex;padding-bottom:5px;options">&nbsp;&nbsp;<div class="checkbox checkRadioOption" ><label> <input type="checkbox" class="checkbox" checked="checked" style="zoom:140%;"></label></div><input type="text" name="valueName" autocomplete="off" class="form-control " placeholder="名称" value="'+$($inputE[i]).attr('label')+'" style="width:30%;">&nbsp;&nbsp;<input type="text" name="value" autocomplete="off" class="form-control " placeholder="值" value="'+$($inputE[i]).val()+'" style="width:30%;"><div style="padding-top:10px;padding-left:10px;cursor:pointer" onClick="removeSelectOption(this)" ><i class="glyphicon-trash glyphicon"></i></div></div>';
                            $("#editorCheckBoxModal_  .addCheckboxOption").append(html);
                        }
                    }
                }
            }
            window.checkBoxDom_ = element;
            window.checkParentDom = element.parent();
            isLayoutClick  = false;
            renderBorder(obj)
        }else if('date,time,datetime-local,month,week'.indexOf(dataType)!=-1){
            $("#editorSelectModal_").addClass('hide');
            $("#editorInputModal_").addClass("hide");
            $("#editorLayout").addClass('hide');
            $("#editorTexareaModal_").addClass('hide');
            $("#editorRadioModal_").addClass('hide');
            $("#editorCheckBoxModal_").addClass('hide');
            $("#editorDateTimeModal_").removeClass('hide');
            //处理回显
            $("#editorDateTimeModal_ .orgname").val($(element).attr('orgname'));
            $("#editorDateTimeModal_ .fieldname").val($(element).attr('fieldname'));
            $("#editorDateTimeModal_ select[name=isRequired]").find("option[value='"+$(element).attr('isRequired')+"']").prop("selected",true);
            $("#editorDateTimeModal_ select[name=type]").find("option[value='"+$(element).attr('type')+"']").prop("selected",true);
            window.dateTimeDom_ = element;
            isLayoutClick  = false;
            renderBorder(obj)
        }
        else{
            isLayoutClick  = true;
        }
   }
}
function renderBorder(obj){
    //去除上一次点击边框效果
    if(prevViewDom){
        prevViewDom.removeClass("borderActive");
        prevViewDom.addClass("borderNoActive");
        prevViewDom.children().eq(1).addClass("hide");
    }
    //点击加载边框线效果
    $(obj).find(".view").addClass("borderActive");
    $(obj).find(".view").removeClass("borderNoActive");
    $(obj).find(".view").children().removeClass("hide");
    prevViewDom = $(obj).find(".view");
}
function onloadDateTimeModal(){
    $("#editorDateTimeModal_ ").find(".orgname").bind("input propertychange",function(event){
        var dom = window.dateTimeDom_;
        $(dom.prev()).html($(this).val());
        $(dom).attr('orgname',$(this).val())
    });
    $("#editorDateTimeModal_ ").find(".fieldname").bind("input propertychange",function(event){
        var dom = window.dateTimeDom_;
        $(dom).attr('fieldname',$(this).val())
    });
    $("#editorDateTimeModal_ ").find(".type").bind("input propertychange",function(event){
        var dom = window.dateTimeDom_;
        $(dom).attr('type',$(this).val())
    });
    $("#editorDateTimeModal_ ").find(".isRequired").bind("input propertychange",function(event){
        var dom = window.dateTimeDom_;
        $(dom).attr('isRequired',$(this).val());
        if('Y' == $(this).val()){
            var id = Math.floor(Math.random()*1000);
            $(dom).attr('isRequiredId',id);
            $(dom.prev()).before('<font id="'+id+'" style="color:red">*</font>&nbsp;');
        }else{
            $("#"+$(dom).attr("isRequiredId")).remove();
        }
    });
}
function onloadCheckBoxModal(){
    $("#editorCheckBoxModal_ ").find(".orgname").bind("input propertychange",function(event){
        var dom = window.checkBoxDom_;
        var domParent = window.checkParentDom;
        $(dom).attr('orgname',$(this).val());
        $(dom).attr('name',$(this).val());
        $(domParent).parent().find(".labelCheckBox").html($(this).val());
        eachcheckBoxDomNature(domParent,$(this).val(),'orgname');
    });
    $("#editorCheckBoxModal_ ").find(".fieldname").bind("input propertychange",function(event){
        var dom = window.checkBoxDom_;
        var domParent = window.checkParentDom;
        $(dom).attr('fieldname',$(this).val());
        eachcheckBoxDomNature(domParent,$(this).val(),'fieldname')
    });
    $("#editorCheckBoxModal_ ").find(".isRequired").bind("input propertychange",function(event){
        var dom = window.checkBoxDom_;
        var domParent = window.checkParentDom;
        $(dom).attr('isRequired',$(this).val());
        eachcheckBoxDomNature(domParent,$(this).val(),'isRequired')
        if('Y' == $(this).val()){
            var id = Math.floor(Math.random()*1000);
            $(dom).attr('isRequiredId',id);
            $(dom.parent().prev().prev()).before('<font id="'+id+'" style="color:red">*</font>&nbsp;');
        }else{
            $("#"+$(dom).attr("isRequiredId")).remove();
        }
    });
}
function eachcheckBoxDomNature(obj,val,name){
    var $chen = $(obj).children();
    console.log($chen.length);
    for(var i = 0;i<$chen.length;i++){
        if('checkbox' == $($chen[i]).attr('type')){
            $($chen[i]).attr(name,val)
        }
    }
}
function onloadRadioModal(){
    $("#editorRadioModal_ ").find(".orgname").bind("input propertychange",function(event){
        var dom = window.radioDom_;
        var parentDom = window.radioParentDom;
        $(parentDom).parent().find(".labelRadio").html($(this).val());
        $(dom).attr('orgname',$(this).val());
        $(dom).attr('name',$(this).val());
        eachRadioDomNature(parentDom,$(this).val(),'orgname');
    });
    $("#editorRadioModal_ ").find(".fieldname").bind("input propertychange",function(event){
        var dom = window.radioDom_;
        var parentDom = window.radioParentDom;
        $(dom).attr('fieldname',$(this).val());
        eachRadioDomNature(parentDom,$(this).val(),'fieldname');
    });
    $("#editorRadioModal_ ").find(".isRequired").bind("input propertychange",function(event){
        var dom = window.radioDom_;
        var parentDom = window.radioParentDom;
        $(dom).attr('isRequired',$(this).val());
        eachRadioDomNature(parentDom,$(this).val(),'isRequired');
        if('Y' == $(this).val()){
            console.log($(parentDom).parent().find('.radio_label'));
            var id = Math.floor(Math.random()*1000);
            $(dom).attr('isRequiredId',id);
            $(parentDom).parent().find('.radio_label').before('<font id="'+id+'" style="color:red">*</font>&nbsp;');
        }else{
            $("#"+$(dom).attr("isRequiredId")).remove();
        }
    });
}
function eachRadioDomNature(obj,val,name){
   var $chen = $(obj).children();
    console.log($chen.length);
    for(var i = 0;i<$chen.length;i++){
        if('radio' == $($chen[i]).attr('type')){
            $($chen[i]).attr(name,val)
        }
    }
}
function onloadTexareaModal(){
    $("#editorTexareaModal_ ").find(".orgname").bind("input propertychange",function(event){
        var dom = window.textareaDom_;
        $(dom.prev()).html($(this).val());
        $(dom).attr('orgname',$(this).val());
        $(dom).attr('name',$(this).val());
    });
    $("#editorTexareaModal_ ").find(".fieldname").bind("input propertychange",function(event){
        var dom = window.textareaDom_;
        $(dom).attr('fieldname',$(this).val())
    });
    $("#editorTexareaModal_ ").find(".isRequired").bind("input propertychange",function(event){
        var dom = window.textareaDom_;
        $(dom).attr('isRequired',$(this).val());
        if('Y' == $(this).val()){
            var id = Math.floor(Math.random()*1000);
            $(dom).attr('isRequiredId',id);
            $(dom.prev()).before('<font id="'+id+'" style="color:red">*</font>&nbsp;');
        }else{
            $("#"+$(dom).attr("isRequiredId")).remove();
        }
    });
}
/**
 * 下拉框修改
 */
function onloadSelectModal(){
    $("#editorSelectModal_ ").find(".orgname").bind("input propertychange",function(event){
        var dom = window.selectDom_;
        $(dom.prev()).html($(this).val());
        $(dom).attr('orgname',$(this).val());
        $(dom).attr('name',$(this).val());
    });
    $("#editorSelectModal_ ").find(".fieldname").bind("input propertychange",function(event){
        var dom = window.selectDom_;
        $(dom).attr('fieldname',$(this).val())
    });
    $("#editorSelectModal_ ").find(".isRequired").bind("input propertychange",function(event){
        var dom = window.selectDom_;
        $(dom).attr('isRequired',$(this).val());
        if('Y' == $(this).val()){
            var id = Math.floor(Math.random()*1000);
            $(dom).attr('isRequiredId',id);
            $(dom.prev()).before('<font id="'+id+'" style="color:red">*</font>&nbsp;');
        }else{
            $("#"+$(dom).attr("isRequiredId")).remove();
        }
    });
}
/**
 * 输入框修改
 */
function onloadInputModal(){
    $("#editorInputModal_ ").find(".orgname").bind("input propertychange",function(event){
        var dom = window.inputDom;
        $(dom.prev()).html($(this).val());
        $(dom).attr('orgname',$(this).val());
        $(dom).attr('name',$(this).val());
    });
    $("#editorInputModal_ ").find(".fieldname").bind("input propertychange",function(event){
        var dom = window.inputDom;
        $(dom).attr('fieldname',$(this).val());
    });
    $("#editorInputModal_ ").find(".orgvalue").bind("input propertychange",function(event){
        var dom = window.inputDom;
        $(dom).attr('value',$(this).val());
    });
    $("#editorInputModal_ ").find(".orgtype").bind("input propertychange",function(event){
        var dom = window.inputDom;
        $(dom).attr('orgtype',$(this).val());
    });
    $("#editorInputModal_ ").find(".placeholder").bind("input propertychange",function(event){
        var dom = window.inputDom;
        $(dom).attr('placeholder',$(this).val());
    });
    $("#editorInputModal_ ").find(".layoutCol").bind("input propertychange",function(event){
        var dom = window.inputDom;
    });
    $("#editorInputModal_ ").find(".isRequired").bind("input propertychange",function(event){
        var dom = window.inputDom;
        $(dom).attr('isRequired',$(this).val());
        if('Y' == $(this).val()){
            var id = Math.floor(Math.random()*1000);
            $(dom).attr('isRequiredId',id);
            $(dom.prev()).before('<font id="'+id+'" style="color:red">*</font>&nbsp;');
        }else{
            $("#"+$(dom).attr("isRequiredId")).remove();
        }
    });
    
}

function checkCheckboxOption(obj){
    $("#editorCheckBoxModal_").delegate(".checkCheckboxOption", "change", function (e) {
        var dom = window.checkBoxDom_;
        var domParent = window.checkParentDom;
        if(e.target.checked){
            var $valueName =  $(e.target).parent().parent().parent();
            var valueName = $valueName.find("[name=valueName]").val();
            var value =  $valueName.find("[name=value]").val();
            console.log(dom);
            var orgname = $(dom).attr("orgname");
            var fieldname = $(dom).attr("fieldname");
            var isRequired = $(dom).attr("isRequired");
            var col = $(dom).attr("col");
            if(''!=valueName && ''!=value){
                var html = '<input type="checkbox" class="getdom" col="'+col+'" isRequired="'+isRequired+'" fieldname="'+fieldname+'"  orgname="'+orgname+'" value='+value+' label='+valueName+'><label  for="">'+valueName+'</label></input>';
                if(undefined == $(domParent.children()).attr("label")){
                    $(domParent).html(html);
                }else{
                    $(domParent).append(html)
                }
            }
        }else{
            var $valueName =  $(e.target).parent().parent().parent();
            var valueName = $valueName.find("[name=valueName]").val();
            var checkHtml = $(domParent).find('input[type=checkbox]');
            var labelHtml = $(domParent).find('label');
            if(checkHtml.length > 0){
                for(var i = 0;i<checkHtml.length ;i++){
                    if(valueName == $(checkHtml[i]).attr('label')){
                        $(checkHtml[i]).remove();
                    }
                }
            }
            if(labelHtml.length > 0){
                for(var i = 0;i<labelHtml.length ;i++){
                    if(valueName == $(labelHtml[i]).html()){
                        $(labelHtml[i]).remove();
                    }
                }
            }
        }
    })
}
function checkRadioOption(obj){
    $("#editorRadioModal_").delegate(".checkRadioOption", "change", function (e) {
        var dom = window.radioDom_;
        var domParent = window.radioParentDom;
        if(e.target.checked){
            var $valueName =  $(e.target).parent().parent().parent();
            var valueName = $valueName.find("[name=valueName]").val();
            var value =  $valueName.find("[name=value]").val();
            console.log(dom);
            var orgname = $(dom).attr("orgname");
            var fieldname = $(dom).attr("fieldname");
            var isRequired = $(dom).attr("isRequired");
            var col = $(dom).attr("col");
            if(''!=valueName && ''!=value){
                var html = '<input type="radio" class="getdom" col="'+col+'" isRequired="'+isRequired+'" fieldname="'+fieldname+'"  orgname="'+orgname+'"  value='+value+' label='+valueName+'><label  for="">'+valueName+'</label></input>';
                if(undefined == $(domParent.children()).attr("label")){
                    $(domParent).html(html);
                }else{
                    $(domParent).append(html)
                }
            }
        }else{
            var $valueName =  $(e.target).parent().parent().parent();
            var valueName = $valueName.find("[name=valueName]").val();
            var radioHtml = $(domParent).find('input[type=radio]');
            var labelHtml = $(domParent).find('label');
            if(radioHtml.length > 0){
                for(var i = 0;i<radioHtml.length ;i++){
                    if(valueName == $(radioHtml[i]).attr('label')){
                        $(radioHtml[i]).remove();
                    }
                }
            }
            if(labelHtml.length > 0){
                for(var i = 0;i<labelHtml.length ;i++){
                    if(valueName == $(labelHtml[i]).html()){
                        $(labelHtml[i]).remove();
                    }
                }
            }
        }
    })
}
/**
 * 下拉框选择数据
 * @param {} obj 
 */
function checkSelectOption(obj){
    $("#editorSelectModal_").delegate(".checkSelectOption", "change", function (e) {
        var dom = window.selectDom_;
        if(e.target.checked){
           var $valueName =  $(e.target).parent().parent().parent();
           var valueName = $valueName.find("[name=valueName]").val();
           var value =  $valueName.find("[name=value]").val();
           if(''!=valueName && ''!=value){
            var html = '<option value='+value+'>'+valueName+'</option>';
            dom.append(html);
           }
        }else{
            var $valueName =  $(e.target).parent().parent().parent();
            var valueName = $valueName.find("[name=valueName]").val();
            var selHtml = $(dom).find('option');
            if(selHtml.length > 0){
                for(var i = 0;i<selHtml.length ;i++){
                    if(valueName == $(selHtml[i]).text()){
                        $(selHtml[i]).remove();
                    }
                }
            }
        }
    })
}
/**
 * 删除下拉框中选中option
 * @param {} obj 
 */
function removeSelectOption(obj){
    var $dom = $(obj).parent();
    if($dom.find(".checkSelectOption").children().children().is(":checked")){
        var dom = window.selectDom_;
        var selHtml = $(dom).find('option');
        var valueName =  $dom.find(".checkSelectOption").parent().find("[name=valueName]").val();
        if(selHtml.length > 0){
            for(var i = 0;i<selHtml.length ;i++){
                if(valueName == $(selHtml[i]).text()){
                    $(selHtml[i]).remove();
                }
            }
        }
        $(obj).parent().remove();
    }else{
        $(obj).parent().remove();
    }
}
function removeRadioOption(obj){
    var $dom = $(obj).parent();
    console.log($($dom).find(".radiobox").is(":checked"))
    if($($dom).find(".radiobox").is(":checked")){
        var domParent = window.radioParentDom;
        var radioBoxHtml = $(domParent).find('input[type=radio]');
        var labelHtml = $(domParent).find('label');
        var valueName =  $dom.find("[name=valueName]").val();
        if(radioBoxHtml.length > 0){
            for(var i = 0;i<radioBoxHtml.length ;i++){
                 if('radio' == $(radioBoxHtml[i]).attr('type')){
                    if(valueName == $(radioBoxHtml[i]).attr('label')){
                        $(radioBoxHtml[i]).remove();
                    }
                   
                 }
            }
        }
        if(labelHtml.length > 0){
            for(var i = 0;i<labelHtml.length ;i++){
                if(valueName == $(labelHtml[i]).html()){
                    $(labelHtml[i]).remove();
                }
            }
        }
        $($dom).remove();
    }else{
        $($dom).remove();
    }
}
function removeCheckboxOption(obj){
    var $dom = $(obj).parent();
    console.log();
    if($dom.find(".checkbox").children().children().is(":checked")){
        var domParent = window.checkParentDom;
        var checkBoxHtml = domParent.children();
        var checkBoxHtml = $(domParent).find('input[type=checkbox]');
        var labelHtml = $(domParent).find('label');
        var valueName =  $dom.find("[name=valueName]").val();
        if(checkBoxHtml.length > 0){
            for(var i = 0;i<checkBoxHtml.length ;i++){
                 if('checkbox' == $(checkBoxHtml[i]).attr('type')){
                    if(valueName == $(checkBoxHtml[i]).attr('label')){
                        $(checkBoxHtml[i]).remove();
                    }
                   
                 }
            }
        }
        if(labelHtml.length > 0){
            for(var i = 0;i<labelHtml.length ;i++){
                if(valueName == $(labelHtml[i]).html()){
                    $(labelHtml[i]).remove();
                }
            }
        }
        $($dom).remove();
    }else{
        $($dom).remove();
    }
}
var currentDocument = null;
var timerSave = 2e3;
var demoHtml = $(".demo").html();
$(window).resize(function () {
    $("body").css("min-height", $(window).height() );
    $(".demo").css("min-height", $(window).height());
    $(".sidebar-nav-right").css("margin-left",$(".sidebar-nav").width()+$(".container").width()+21);
});
$(document).ready(function () {
    $("body").css("min-height", $(window).height());
    $(".demo").css("min-height", $(window).height());
    $(".sidebar-nav-right").css("margin-left",$(".sidebar-nav").width()+$(".container").width()+21);
    $(".demo, .demo .column").sortable({
        connectWith: ".column",
        opacity: .35,
        handle: ".drag"
    });
    $(".sidebar-nav .lyrow").draggable({
        connectToSortable: ".demo",
        helper: "clone",
        handle: ".drag",
        drag: function (e, t) {
            t.helper.width(400)
        },
        stop: function (e, t) {
            $(".demo .column").sortable({
                opacity: .35,
                connectWith: ".column"
            });
            if($(".demo #formEditor").length > 0 ){
                var UEditorId = "formEditor_"+Math.floor(Math.random()*1000);
                $(".demo #formEditor").attr('id',UEditorId);
                loadUEditor(UEditorId);
                UEditorAddListener(UEditorId);
            }
            //拖拽后增加标记
            if($(".demo .addLayout").length > 0){
                var id = Math.floor(Math.random()*99999);
                $(".demo .addLayout").addClass('editLayout');
                var addE = $(".demo .addLayout");
                for(var i = 0;i<addE.length;i++){
                    if(undefined ==  $($(addE[i]).find(".view").children()[0]).attr("id")){
                        $($(addE[i]).find(".view").children()[0]).attr("id",id);
                    }
                }
            }
            if($(".demo .addElement").length > 0){
                var id = Math.floor(Math.random()*99999);
                $(".demo .addElement").addClass('editElement');
                var addE = $(".demo .addElement");
                for(var i = 0;i<addE.length;i++){
                    if(undefined == $(addE[i]).find(".view").children().attr("id")){
                        $(addE[i]).find(".view").children().attr("id",id);
                    }
                }
            }
        }
    });
    $(".sidebar-nav .box").draggable({
        connectToSortable: ".column",
        helper: "clone",
        handle: ".drag",
        drag: function (e, ui) {
            var sourceElement = $(ui.helper.context);
            ui.helper.width(400)
        },
        stop: function (e,ui) {
            if($(".demo .addElement").length > 0){
                $(".demo .addElement").addClass('editElement');
                $(".demo .addElement").attr("id",Math.floor(Math.random()*1000));
            }
            var $demo = $('.demo');
            $demo.find('label,input,select,textarea,radio,checkbox').each(function(e){
                var htmlDom = $(this).parent().parent().parent().parent();
                var classArr = htmlDom.attr('class').split(' ');
                var col = $(this).attr("col");
                if(undefined == col){
                    var colArr = classArr[0].split('-');
                    $(this).attr("col",colArr[2]);
                    $(htmlDom).find(".getdom").attr("col",colArr[2]);
                }
            });
            handleJsIds()
        }
    });
    $("[data-target=#downloadModal]").click(function (e) {
        e.preventDefault();
        downloadLayoutSrc()
    });
    $("[data-target=#toJsonModal]").click(function (e) {
        e.preventDefault();
        downloadLayoutSrc();
        loadJson();
    });
    
    $("#download").click(function () {
        downloadLayout();
        return false
    });
    $("#downloadhtml").click(function () {
        downloadHtmlLayout();
        return false
    });
    /**
     * 编辑
     */
    $("#edit").click(function () {
        for(var i=0;i<$("body").find(".view").length;i++){
            $("body").find(".view").eq(i).addClass("borderNoActive");
            $("body").find(".view").eq(i).css("background-color","rgba(236,245,255,.3)");
            $("body").find(".view").eq(i).css("border","1px dashed hsla(0,0%,66.7%,.5)");
        }
        $("body").removeClass("devpreview sourcepreview");
        $("body").addClass("edit");
        removeMenuClasses();
        $(this).addClass("active");
        $(".showTexarea").remove();
        $(".sidebar-nav-right").show();
        $(".sidebar-nav .el-aside").css("width","250");
        $(".ui-draggable").css("padding-top","0px");
        $(".demo  .editLayout").children().next().next().addClass("view");
        $(".demo  .editElement").children().next().next().addClass("view");
        return false
    });
    $("#clear").click(function (e) {
        e.preventDefault();
        clearDemo()
    });
    $("#devpreview").click(function () {
        $("body").removeClass("edit sourcepreview");
        $("body").addClass("devpreview");
        removeMenuClasses();
         $(this).addClass("active");
        return false
    });
    $("#sourcepreview").click(function () {
        var e = "";
        var UEditorHtml = '<div class="showTexarea" style="margin:20px;">';
        var $UEditorTextarea = $(".demo").find("textarea");
        if($UEditorTextarea.length > 0){
            $UEditorTextarea.each(function(e){
                if('text/plain' == $(this).attr("type")){
                    var id =  $(this).prev().attr("id");
                    UEditorHtml +=UE.getEditor(id).getContent();
                }
            });
            UEditorHtml+='</div>';
            if(UEditorHtml.length > 0){
            }
        }
        $("body").removeClass("edit");
        $("body").addClass("devpreview sourcepreview");
        $(".sidebar-nav .el-aside").css("width","200");
        $(".ui-draggable").css("padding-top","10px");
        removeMenuClasses();
        $(this).addClass("active");
        for(var i=0;i<$("body").find(".view").length;i++){
            $("body").find(".view").eq(i).removeClass("borderActive");
            $("body").find(".view").eq(i).removeClass("borderNoActive");
            $("body").find(".view").eq(i).css("background-color","white");
            $("body").find(".view").eq(i).css("border","0");
            $("body").find(".remove2").eq(i).addClass("hide");
        }
        $(".demo  .editLayout").children().next().next().removeClass("view");
        $(".demo  .editElement").children().next().next().removeClass("view");
        return false
    });
    $(".nav-header").click(function () {
        $(".sidebar-nav .boxes, .sidebar-nav .rows").hide();
        $(this).next().slideDown()
    });
    $(".addTR").click(function(){
		$('#addTR').modal('show');
		$('#addTR input').val(' ');
    });
    $(".addRadio").click(function(){
		$('#addRadio').modal('show');
		$('#addRadio input').val(' ');
    });
    $(".addCheckbox").click(function(){
		$('#addCheckbox').modal('show');
		$('#addCheckbox input').val(' ');
    });
    var index =0;
    $(".saveCheckboxVal").click(function(){
		var fieldName = $(".checkValForm .fieldname").val();
		var orgName = $(".checkValForm .orgname").val();
		var isReq = $(".checkValForm .isReq").val();
		var isReqText = 'Y'==isReq?"是":"否";
		var html = '<tr id="'+index+'"><td>'+fieldName+'</td><td>'+orgName+'</td><td value='+isReq+'>'+isReqText+'</td><td><button type="button" class="btn btn-danger btn-xs removeTr" >删除</button></td></tr>';
		index++;
        $("#checkForm table tbody").append(html)
        $('#addCheckbox').modal('hide');
	})
    $(".saveRadioVal").click(function(){
		var fieldName = $(".radioValForm .fieldname").val();
		var orgName = $(".radioValForm .orgname").val();
		var isReq = $(".radioValForm .isReq").val();
		var isReqText = 'Y'==isReq?"是":"否";
		var html = '<tr id="'+index+'"><td>'+fieldName+'</td><td>'+orgName+'</td><td value='+isReq+'>'+isReqText+'</td><td><button type="button" class="btn btn-danger btn-xs removeTr" >删除</button></td></tr>';
		index++;
        $("#radioForm table tbody").append(html);
        $('#addRadio').modal('hide');
	})
    $(".saveAddTr").click(function(){
		var fieldName = $("#selectValForm .fieldname").val();
        var orgName = $("#selectValForm .orgname").val();
        if(' '!=fieldName && ' '!=orgName){
            var html = '<tr id="'+index+'"><td>'+fieldName+'</td><td>'+orgName+'</td><td><button type="button" class="btn btn-danger btn-xs removeTr" >删除</button></td></tr>';
            index++;
            $("#selectForm table tbody").append(html);
            $('#addTR').modal('hide');
        }else{
            $("#addTR .topinfo .info").html('请输入下拉选择数据！');
            $("#addTR .topinfo").removeClass('hide');
        }
    });
    $("#selectForm table").on('click','button',function(e){
		$("#"+$(this).parent().parent()[0].id).remove();
    });
    $("#radioForm table").on('click','button',function(e){
		$("#"+$(this).parent().parent()[0].id).remove();
    });
    $("#checkForm table").on('click','button',function(e){
		$("#"+$(this).parent().parent()[0].id).remove();
	})
    var layouteditor = '';
    $('body.edit .demo').on("click","[data-target=#editorLayout],[data-target=#editorTitle],[data-target=#editorInputModal],[data-target=#editorSelectModal],[data-target=#editorTextareaModal],[data-target=#editorRadioModal],[data-target=#editorCheckboxModal],[data-target=#editorDateTimeModal]",function(e) {
        /**布局绘制  start*/
        //layouteditor = $(this).parent().parent().find('.view');
        // window.layoutEditor = layouteditor;
        // /**布局绘制  end*/
        // /**标题  start*/
        // var titleEdit = $(this).parent().parent().parent().find('.view');
        // window.titleEdit = titleEdit;
        // /**标题  end*/
        // var domType = $($(this).parent().parent().parent().find('.view').children().children()).attr('type');
        // var dom = $(this).parent().parent().parent().find('.view').children().children();
        // window.domClick = dom;
        // console.log(domType);
        // if('text'==domType){
        //     $("#editorInputModal input[name=fieldname]").val(dom.attr('fieldname'));
        //     //$("#editorInputModal input[name=orgname]").val(dom.attr('orgname'));
        //     $("#editorInputModal select[name=orgname]").find("option[value='"+dom.attr('orgname')+"']").prop("selected",true);
		// 	$("#editorInputModal input[name=orgvalue]").val(dom.attr('value'));
        //     $("#editorInputModal .isRequired").find("option[value='"+dom.attr('isRequired')+"']").prop("selected",true);
        //     $("#editorInputModal .orgtype").find("option[value='"+dom.attr('orgtype')+"']").prop("selected",true);
        // }else if('select'==domType){
        //     $("#selectForm input[name=fieldname]").val(dom.attr('fieldname'));
        //     //$("#selectForm input[name=orgname]").val(dom.attr('orgname'));
        //     $("#selectForm select[name=orgname]").find("option[value='"+dom.attr('orgname')+"']").prop("selected",true);
        //     $("#selectForm .isRequired").find("option[value='"+dom.attr('isRequired')+"']").prop("selected",true);
		// 	var optionHtml = ' ';
		// 	var index = 0;
		// 	$(dom).find("option").each(function(){
		// 		optionHtml += '<tr id="'+index+'"><td>'+$(this).eq(0).html()+'</td><td>'+$(this).eq(0).val()+'</td><td><button type="button" class="btn btn-danger btn-xs removeTr" >删除</button></td></tr>';
		// 		index++;
		// 	});
		// 	$("#selectForm table tbody").html(optionHtml);
        // }else if('textarea' == domType){
        //     $("#textareaForm input[name=fieldname]").val(dom.attr('fieldname'));
        //    // $("#textareaForm input[name=orgname]").val(dom.attr('orgname'));
        //     $("#textareaForm select[name=orgname]").find("option[value='"+dom.attr('orgname')+"']").prop("selected",true);
		// 	$("#textareaForm .isRequired").find("option").prop("selected",false);
		// 	$("#textareaForm .isRequired").find("option[value='"+dom.attr('isRequired')+"']").prop("selected",true);
        // }else if('radio' == domType){
        //     $("#radioForm input[name=fieldname]").val(dom.attr('name'));
        //     //$("#radioForm input[name=orgname]").val(dom.attr('title'));
        //     $("#radioForm select[name=orgname]").find("option[value='"+dom.attr('orgname')+"']").prop("selected",true);
		// 	var index = 0;
		// 	var isReq = '';
		// 	var html = '';
		// 	var isReqText = '';
		// 	$(dom.parent()).find("label").each(function(){
		// 		if(''!=$(this).eq(0).html() && ''!=$(this).eq(0).next().val() && ''!=$(this).eq(0).next().attr("checked")){
        //             var isChecked = $(this).eq(0).next().attr("checked");
		// 			if('checked' == isChecked){
		// 				isReq = 'Y';
		// 				isReqText = '是';
		// 			}else{
		// 				isReq = 'N';
		// 				isReqText = '否';
		// 			}
		// 			html += '<tr id="'+index+'"><td>'+$(this).eq(0).html()+'</td><td>'+$(this).eq(0).prev().val()+'</td><td value='+isReq+'>'+isReqText+'</td><td><button type="button" class="btn btn-danger btn-xs removeTr" >删除</button></td></tr>';
		// 			index++;
		// 		}
		// 	});
		// 	$("#radioForm table tbody").html(html);
        // }else if('checkbox' == domType){
		// 	$("#checkForm input[name=fieldname]").val(dom.attr('name'));
        //     //$("#checkForm input[name=orgname]").val(dom.attr('title'));
        //     $("#checkForm select[name=orgname]").find("option[value='"+dom.attr('orgname')+"']").prop("selected",true);
		// 	var index = 0;
		// 	var isReq = '';
		// 	var html = '';
		// 	var isReqText = '';
		// 	$(dom.parent()).find("label").each(function(){
		// 		if(''!=$(this).eq(0).html() && ''!=$(this).eq(0).next().val() && ''!=$(this).eq(0).next().attr("checked")){
		// 			var isChecked = $(this).eq(0).next().attr("checked");
		// 			if('checked' == isChecked){
		// 				isReq = 'Y';
		// 				isReqText = '是';
		// 			}else{
		// 				isReq = 'N';
		// 				isReqText = '否';
		// 			}
		// 			html += '<tr id="'+index+'"><td>'+$(this).eq(0).html()+'</td><td>'+$(this).eq(0).prev().val()+'</td><td value='+isReq+'>'+isReqText+'</td><td><button type="button" class="btn btn-danger btn-xs removeTr" >删除</button></td></tr>';
		// 			index++;
		// 		}
		// 	});
		// 	$("#checkForm table tbody").html(html);
        // }else if('date,time,datetime-local,month,week'.indexOf(domType)!=-1){
        //     $("#dateTimeForm input[name=fieldname]").val(dom.attr('name'));
        //     //$("#dateTimeForm input[name=orgname]").val(dom.attr('title'));
        //     $("#dateTimeForm select[name=orgname]").find("option[value='"+dom.attr('orgname')+"']").prop("selected",true);
        //     $("#dateTimeForm .isRequired").find("option").prop("selected",false);
        //     $("#dateTimeForm .isRequired").find("option[value='"+dom.attr('isRequired')+"']").prop("selected",true);
        //     $("#dateTimeForm .type").find("option[value='"+dom.attr('type')+"']").prop("selected",true);
		// }else if('label' == domType){
        //     $("#editorTitle .title").val(dom.attr('title'));
        // }
    });
    // $(".savecontent").click(function(){
    //     var nameFlag = $(this).data("name");
    //     var div;
    //     var dom;
    //     if(!window.isUEditor){
    //          dom = window.domClick;
    //          div = dom.parent();
    //     }else{
    //         dom = window.domClick.target;
    //     }
    //     if('data-input' == nameFlag){
    //         var id;
    //         if(window.isUEditor){
    //             id = 'editorInputTableModal';
    //         }else{
    //             id = 'editorInputModal';
    //         }
    //         var serializeArray = $('#'+id+' #inputForm').serializeArray();
    //         for(var i = 0;i<serializeArray.length;i++){
    //             if('fieldname' == serializeArray[i].name){
	// 				$(dom).attr('id',serializeArray[i].value);
	// 				$(dom).attr('name',serializeArray[i].value)
	// 			}
	// 			if('orgname' == serializeArray[i].name){
	// 				$(dom).attr('title',serializeArray[i].value);
	// 			}
	// 			if('orgvalue' == serializeArray[i].name){
	// 				$(dom).attr('value',serializeArray[i].value);
	// 			}
	// 			if('orgtype' == serializeArray[i].name){
	// 				$(dom).attr('orgtype',serializeArray[i].value);
    //             }
    //             if('isRequired' == serializeArray[i].name){
	// 				if('Y' == serializeArray[i].value){
	// 					$(div).addClass('has-error');
	// 				}else if('N' == serializeArray[i].value){
	// 					$(div).removeClass('has-error');
	// 				}
	// 			}
    //             $(dom).attr(serializeArray[i].name,serializeArray[i].value);
    //         }
    //         $("#"+id).modal('hide');  //手动关闭
    //         window.isUEditor = false;
    //     }else if('data-select' == nameFlag){
    //             var id;
    //             if(window.isUEditor){
    //                 id = 'editorSelectTableModal';
    //             }else{
    //                 id = 'editorSelectModal';
    //             }
    //             var   serializeArray = $('#'+id+' #selectForm').serializeArray();
	// 			for(var i = 0;i<serializeArray.length;i++){
	// 				if('fieldname' == serializeArray[i].name){
	// 					$(dom).attr('id',serializeArray[i].value);
	// 					$(dom).attr('fieldname',serializeArray[i].value)
	// 				}
	// 				if('orgname' == serializeArray[i].name){
	// 					$(dom).attr('title',serializeArray[i].value);
	// 				}
	// 				if('isRequired' == serializeArray[i].name){
	// 					if('Y' == serializeArray[i].value){
	// 						$(div).addClass('has-error');
	// 					}else if('N' == serializeArray[i].value){
	// 						$(div).removeClass('has-error');
	// 					}
	// 				}
	// 				$(dom).attr(serializeArray[i].name,serializeArray[i].value)
	// 			}
	// 			var optionHtml = ' ';
	// 			$("#"+id+" #selectForm table tbody").find("tr").each(function(){
	// 				optionHtml +='<option value="'+$(this).find("td").eq(1).html()+'" >'+$(this).find("td").eq(0).html()+'</option>';
    //             });
    //             $(dom).html(optionHtml);
    //             $("#"+id).modal('hide');  //手动关闭
    //             window.isUEditor = false;
    //     }else if('data-textarea' == nameFlag){
    //             var id;
    //             if(window.isUEditor){
    //                 id = 'editorTextareaTableModal';
    //             }else{
    //                 id = 'editorTextareaModal';
    //             }
    //             var serializeArray = $('#'+id+' #textareaForm').serializeArray();
    //             for(var i = 0;i<serializeArray.length;i++){
    //                 if('fieldname' == serializeArray[i].name){
    //                     $(dom).attr('id',serializeArray[i].value);
    //                     $(dom).attr('name',serializeArray[i].value)
    //                 }
    //                 if('orgname' == serializeArray[i].name){
    //                     $(dom).attr('title',serializeArray[i].value);
    //                 }
    //                 if('orgvalue' == serializeArray[i].name){
    //                     $(dom).attr('value',serializeArray[i].value);
    //                 }
    //                 if('isRequired' == serializeArray[i].name){
    //                     if('Y' == serializeArray[i].value){
    //                         $(div).addClass('has-error');
    //                     }else if('N' == serializeArray[i].value){
    //                         $(div).removeClass('has-error');
    //                     }
    //                 }
    //                 $(dom).attr(serializeArray[i].name,serializeArray[i].value)
    //             }
    //             $("#"+id).modal('hide');  //手动关闭
    //             window.isUEditor = false;
    //     }else if('data-radio' == nameFlag){
    //             var id;
    //             if(window.isUEditor){
    //                 id = 'editorRadioTableModal';
    //             }else{
    //                 id = 'editorRadioModal';
    //             }
    //             var serializeArray = $('#'+id+' #radioForm').serializeArray();
    //             for(var i = 0;i<serializeArray.length;i++){
    //                 if('fieldname' == serializeArray[i].name){
    //                     $(dom).attr('id',serializeArray[i].value);
    //                     $(dom).attr('name',serializeArray[i].value)
    //                 }
    //                 if('orgname' == serializeArray[i].name){
    //                     $(dom).attr('title',serializeArray[i].value);
    //                 }
    //                 $(dom).attr(serializeArray[i].name,serializeArray[i].value)
    //             }
    //             var radioHtml = '';
    //             $("#"+id+" #radioForm table tbody").find("tr").each(function(){
    //                 if('是' == $(this).find("td").eq(2).html()){
    //                     radioHtml +='<input title='+$(dom).attr('title')+'col="'+$(dom).attr('col')+'" orgname="'+$(dom).attr('orgname')+'" id="'+$(dom).attr('id')+'" name='+$(dom).attr('name')+' type="radio" checked value='+$(this).find("td").eq(1).html()+'><label class="radioLabelEdit" for="name">'+$(this).find("td").eq(0).html()+'</label>';
    //                 }else{
    //                     radioHtml +='<input title='+$(dom).attr('title')+' col="'+$(dom).attr('col')+'" orgname="'+$(dom).attr('orgname')+'" id="'+$(dom).attr('id')+'" name='+$(dom).attr('name')+' type="radio" value='+$(this).find("td").eq(1).html()+'><label class="radioLabelEdit" for="name">'+$(this).find("td").eq(0).html()+'</label>';
    //                 }
    //             });
    //             if(''!= radioHtml ){
    //                 if(window.isUEditor){
    //                     $(dom).parent().html(radioHtml);
    //                 }else{
    //                     $(dom.parent()).html(radioHtml);
    //                 }
    //             }
    //             $("#"+id).modal('hide');  //手动关闭
    //             window.isUEditor = false;
    //     }else if('data-check' == nameFlag){
    //             var id;
    //             if(window.isUEditor){
    //                 id = 'editorCheckboxTableModal';
    //             }else{
    //                 id = 'editorCheckboxModal';
    //             }
    //             var serializeArray = $('#'+id+' #checkForm').serializeArray();
    //             for(var i = 0;i<serializeArray.length;i++){
    //                 if('fieldname' == serializeArray[i].name){
    //                     $(dom).attr('id',serializeArray[i].value);
    //                     $(dom).attr('name',serializeArray[i].value)
    //                 }
    //                 if('orgname' == serializeArray[i].name){
    //                     $(dom).attr('title',serializeArray[i].value);
    //                 }
    //                 $(dom).attr(serializeArray[i].name,serializeArray[i].value)
    //             }
    //             var checkHtml = '';
    //             $("#"+id+" #checkForm table tbody").find("tr").each(function(){
    //                 if('是' == $(this).find("td").eq(2).html()){
    //                     checkHtml +='<input title='+$(dom).attr('title')+' col="'+$(dom).attr('col')+'" orgname="'+$(dom).attr('orgname')+'" id="'+$(dom).attr('id')+'" name='+$(dom).attr('name')+' type="checkbox" checked value='+$(this).find("td").eq(1).html()+'><label class="radioLabelEdit" for="name">'+$(this).find("td").eq(0).html()+'</label>';
    //                 }else{
    //                     checkHtml +='<input title='+$(dom).attr('title')+' col="'+$(dom).attr('col')+'" orgname="'+$(dom).attr('orgname')+'" id="'+$(dom).attr('id')+'" name='+$(dom).attr('name')+' type="checkbox" value='+$(this).find("td").eq(1).html()+'><label class="radioLabelEdit" for="name">'+$(this).find("td").eq(0).html()+'</label>';
    //                 }
    //             });
    //             if(''!= checkHtml){
    //                 if(window.isUEditor){
    //                     $(dom).parent().html(checkHtml);
    //                 }else{
    //                     $(dom.parent()).html(checkHtml);
    //                 }
    //             }
    //             $("#"+id).modal('hide');  //手动关闭
    //             window.isUEditor = false;
    //     }else if('data-date' == nameFlag){
    //             var id;
    //             if(window.isUEditor){
    //                 id = 'editorDateTimeTableModal';
    //             }else{
    //                 id = 'editorDateTimeModal';
    //             }
    //             var serializeArray = $('#'+id+' #dateTimeForm').serializeArray();
    //             for(var i = 0;i<serializeArray.length;i++){
    //                 if('fieldname' == serializeArray[i].name){
    //                     $(dom).attr('id',serializeArray[i].value);
    //                     $(dom).attr('name',serializeArray[i].value)
    //                 }
    //                 if('orgname' == serializeArray[i].name){
    //                     $(dom).attr('title',serializeArray[i].value);
    //                 }
    //                 if('isRequired' == serializeArray[i].name){
    //                     if('Y' == serializeArray[i].value){
    //                         $(div).addClass('has-error');
    //                     }else if('N' == serializeArray[i].value){
    //                         $(div).removeClass('has-error');
    //                     }
    //                 }
    //                 $(dom).attr(serializeArray[i].name,serializeArray[i].value);
    //                 $("#"+id).modal('hide');  //手动关闭
    //                 window.isUEditor = false;
    //             }
    //     }
    // });
    $(".saveTitle").click(function(e){
        var _titleEdit = window.titleEdit;
        var _textareaVal = $("#editorTitle .title").val();
        var _id = $(_titleEdit.children().children()).attr('id');
        if(undefined!=_textareaVal && ''!=_textareaVal){
            $(_titleEdit.children().children()).attr('title',_textareaVal);
            $(_titleEdit.children().children()).attr('id',undefined == _id?Math.ceil(Math.random()*1000):_id);
            $(_titleEdit.children().children()).text(_textareaVal);
            $("#editorTitle").modal('hide');  //手动关闭
        }else{
            $("#editorTitle .topinfo .info").html('请输入标题内容');
            $("#editorTitle .topinfo").removeClass('hide');
        }
        var $demo = $(".demo");
        var optionHtml='<option value=" ">请选择</option>';
        var optionMap;
        var labelArr = [];
        $demo.find('label').each(function(e){
            if(undefined != $(this).attr('id') && undefined != $(this).attr('title')){
                optionMap = {value:'',text:''};
                optionHtml +='<option value="'+$(this).attr('id')+'" >'+$(this).attr('title')+'</option>';
                optionMap.value = $(this).attr('id');
                optionMap.text = $(this).attr('title');
                labelArr.push(optionMap);
            }
        });
        window.labelArr = labelArr;
        $("#editorInputModal select[name=orgname]").html(optionHtml);
        $("#editorSelectModal select[name=orgname]").html(optionHtml);
        $("#editorTextareaModal select[name=orgname]").html(optionHtml);
        $("#editorRadioModal select[name=orgname]").html(optionHtml);
        $("#editorCheckboxModal select[name=orgname]").html(optionHtml);
        $("#editorDateTimeModal select[name=orgname]").html(optionHtml);
    });
    $(".saveLayout").click(function(e){
        var _layouteditor = window.layoutEditor;
        var layoutCol = $("#editorLayout .layoutCol").val();
        var inputDom = $("#editorLayout .ratio input");
        if(layoutCol <= 12){
            var _result = 0;
            var _strResult='';
            for(var i = 0;i<inputDom.length;i++){
                _result+=parseInt($(inputDom[i]).val());
                _strResult+=$(inputDom[i]).val()+',';
            }
            if(_result <= 12){
                var _div='';
                var resultArr = _strResult.split(',');
                for(var i = 0;i<resultArr.length;i++){
                    if('' != resultArr[i]){
                        _div +='<div class="col-md-'+resultArr[i]+' column ui-sortable"></div>';
                    }
                }
                if(_result < 12){
                    var _remain = 12 - _result;
                    _div+='<div class="col-md-'+_remain+' column ui-sortable"></div>';
                }
                _layouteditor.children().html(_div);
                $(".demo .column").sortable({
                    opacity: .35,
                    connectWith: ".column"
                })
                $("#editorLayout").modal('hide');  //手动关闭
            }else{
                $(".topinfo .info").html('您输入的总比例'+_result+',已超出范围!');
                $("#editorLayout .topinfo").removeClass('hide');
            }
        }else{
            $("#editorLayout .topinfo .info").html('您输入了'+layoutCol+'列,已超出范围!');
            $("#editorLayout .topinfo").removeClass('hide');
        }

    });
    /**
     * 切换修改 默认值效果
     */
    $("#editorInputModal_ .isOrgValue").bind("change",function(e){
        if('A' == $(this).val()){
            $("#editorInputModal_ .orgvalue").removeClass('hide');
            $(".date_linkage").addClass('hide');
            $(".date_formula").addClass('hide');
        }else if('B' == $(this).val()){
            $("#editorInputModal_ .orgvalue").addClass('hide');
            $(".date_formula").addClass('hide');
            $(".date_linkage").removeClass('hide');
        }else if('C' == $(this).val()){
            $("#editorInputModal_ .orgvalue").addClass('hide')
            $(".date_linkage").addClass('hide')
            $(".date_formula").removeClass('hide');
        }
    });
    $("#editorLayout .layoutCol").bind("change",function(event){
       var value = $(this).val();
       var domId = window.selectDomId;
       var domObj = window.selectDom;
       var col = value;
       var ratio = 12/value;
       var html = '';
       for(var i=0;i<col;i++){
        html+='<div class="col-md-'+ratio+' column" type="grid-layout" ></div>'
       }
       $("#"+domId).html(html);
       $(".demo, .demo .column").sortable({
            connectWith: ".column",
            opacity: .35,
            handle: ".drag"
        });
    });
    $(".UEditorclick").click(function(){
        var insertDom = $(this).parent().find(".view").children();
        if('text' == insertDom.children().attr("type") || 'textarea' == insertDom.children().attr("type") || 'date,time,datetime-local,month,week'.indexOf(insertDom.children().attr("type"))!=-1){
            $(insertDom.children()).removeClass('default');
            $(insertDom.children()).css("width","96%");
        }
        var $UEditorTextarea = $(".demo").find("textarea");
        if($UEditorTextarea.length > 0){
            $UEditorTextarea.each(function(e){
                if('text/plain' == $(this).attr("type")){
                    var id =  $(this).prev().attr("id");
                    if(id ==  window.UEditorId){
                        UE.getEditor(id).focus();
                        UE.getEditor(id).execCommand('insertHtml',insertDom.html());
                    }
                }
            })
        }
    });
    $("#editorSelectModal_ .addOption").click(function(){
        var html = '<div style="display:flex;padding-bottom:5px;options">&nbsp;&nbsp;<div class="checkbox checkSelectOption" ><label> <input type="checkbox"style="zoom:140%;"></label></div><input type="text" name="valueName" autocomplete="off" class="form-control " placeholder="名称" style="width:30%;">&nbsp;&nbsp;<input type="text" name="value" autocomplete="off" class="form-control " placeholder="值" style="width:30%;"><div style="padding-top:10px;padding-left:10px;cursor:pointer" onClick="removeSelectOption(this)" ><i class="glyphicon-trash glyphicon"></i></div></div>';
        $("#editorSelectModal_  .addSelectOption").append(html);
    });
    $("#editorRadioModal_ .addOption").click(function(){
        var html = '<div style="display:flex;padding-bottom:5px;options">&nbsp;&nbsp;<div class="checkbox checkRadioOption" ><label> <input type="checkbox" style="zoom:140%;" class="radiobox"></label></div><input type="text" name="valueName" autocomplete="off" class="form-control " placeholder="名称" style="width:30%;">&nbsp;&nbsp;<input type="text" name="value" autocomplete="off" class="form-control " placeholder="值" style="width:30%;"><div style="padding-top:10px;padding-left:10px;cursor:pointer" onClick="removeRadioOption(this)" ><i class="glyphicon-trash glyphicon"></i></div></div>';
        $("#editorRadioModal_  .addRadioOption").append(html);
    });
    $("#editorCheckBoxModal_ .addOption").click(function(){
        var html = '<div style="display:flex;padding-bottom:5px;options">&nbsp;&nbsp;<div class="checkbox checkCheckboxOption" ><label> <input type="checkbox"style="zoom:140%;" class="checkbox"></label></div><input type="text" name="valueName" autocomplete="off" class="form-control " placeholder="名称" style="width:30%;">&nbsp;&nbsp;<input type="text" name="value" autocomplete="off" class="form-control " placeholder="值" style="width:30%;"><div style="padding-top:10px;padding-left:10px;cursor:pointer" onClick="removeCheckboxOption(this)" ><i class="glyphicon-trash glyphicon"></i></div></div>';
        $("#editorCheckBoxModal_  .addCheckboxOption").append(html);
    });
    removeElm();
    configurationElm(); 
    gridSystemGenerator();
    onloadInputModal();
    onloadSelectModal();
    checkSelectOption();
    checkRadioOption();
    checkCheckboxOption();
    onloadTexareaModal();
    onloadRadioModal();
    onloadCheckBoxModal();
    onloadDateTimeModal();
    setInterval(function () {
        handleSaveLayout()
    }, timerSave)
})