<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>自定义表单</title>
	<link rel="stylesheet" type="text/css" href="./bootstrap/css/bootstrap.min.css">
	<link type="text/css" href="bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
	<link type="text/css" href="css/theme.css" rel="stylesheet">
	<link type="text/css" href="css/menu.css" rel="stylesheet">
	<link type="text/css" href="images/icons/css/font-awesome.css" rel="stylesheet">
	<link type="text/css" href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,600'
		rel='stylesheet'>
</head>

<body>
	<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<div class="">
				<a class="btn btn-navbar" data-toggle="collapse" data-target=".navbar-inverse-collapse">
					<i class="icon-reorder shaded"></i>
				</a>
				<a class="brand" href="main.html">
						<img src="./file/favicon.png" style="width:30px;heigth:30px;">
					自定义表单
				</a>
				<div class="nav-collapse collapse navbar-inverse-collapse">
					<ul class="nav pull-right">
						<li class="nav-user dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								<img src="images/user.png" class="nav-avatar" />
								<b class="caret"></b>
							</a>
						</li>
					</ul>
				</div><!-- /.nav-collapse -->
			</div>
		</div><!-- /navbar-inner -->
	</div><!-- /navbar -->
	<div class="">
		<div class="" >
			<div class="row" style="display: flex;">
				<div class="navbarMenu">
					<div class="sidebar">
						<ul class="widget widget-menu unstyled">
							<li class="active">
								<a href="main.html">
									<i class="menu-icon icon-dashboard"></i>
									动态表单
								</a>
							</li>
							<li class="active">
								<a href="main.html">
									<i class="menu-icon icon-dashboard"></i>
									数据字典
								</a>
							</li>
							<li class="active">
								<a href="main.html">
									<i class="menu-icon icon-dashboard"></i>
									表单参数
								</a>
							</li>
						</ul>
						<!--/.widget-nav-->
					</div>
					<!--/.sidebar-->
				</div>
				<!--/.span3-->
				<div class="">
					<div class="content">
						<div class="module">
							<div class="module-head">
								<h3>动态表单</h3>
							</div>
							<div class="module-head_1">
								<div class="controls">
									<button type="submit" class="btn btn-primary add">新增</button>
								</div>
							</div>
							<div class="module-body table">
								<table cellpadding="0" cellspacing="0" border="0" class="datatable-1 table table-bordered table-striped	 display" width="100%">
								</table>
							</div>
						</div><!--/.module-->
					<br />
					</div><!--/.content-->
				</div><!--/.span9-->
			</div>
		</div>
		<!--/.container-->
	</div>
	<!--/.wrapper-->
	<div class="footer">
		<div class="container">
		</div>
	</div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					新增表单
				</h4>
			</div>
			<div class="modal-body">
				<div class="alert alert-warning hide">
						<a href="#" class="close" data-dismiss="alert">
							&times;
						</a>
						<strong>警告！</strong><div class="message"></div>
				</div>
				<form id="inputForm"  role="form">
					<div class="form-group ">
						<label for="name" >表单名称</label>
						<div class="invalid-feedback hide"><small>表单名称不能为空!</small></div>
						<input type="text" name="name" autocomplete="off" class="form-control" placeholder="表单名称" style="width:96%;" required="required">
					</div>
					<div class="form-group has-error" id="">
						<label for="name">表单编码</label>
						<div class="invalid-feedback hide"><small>表单编码不能为空!</small></div>
						 <input type="text" name="code" autocomplete="off" class="form-control hide" placeholder="表单编码" style="width:96%;"> 
					</div>
					<div class="form-group">
						<label for="name">表单类型</label>
						<select name="formType" autocomplete="off" class="form-control" style="width:98%;">
							<option value="UED">模板设计</option>
							<option value="UEGRID">栅格类型</option>
							<option value="UE">自定义类型</option>
						</select>
					</div>
					<div class="form-group">
						<label for="name">表单说明</label>
						<textarea name="common" class="form-control" style="width:96%;"></textarea>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭
				</button>
				<button type="button" class="btn btn-primary submitCustFrom">
					提交
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>
	<script src="scripts/jquery-1.9.1.min.js"></script>
	<script src="bootstrap/js/bootstrap.min.js"></script>
	<script src="scripts/datatables/jquery.dataTables.js"></script>
	<script src="./js/config.js"></script>
	<script>
		function design(obj) {
			window.open("./index.html?id=" + $(obj).attr('title')+"&formType="+$(obj).attr('type'), "_self");
		}
		function loadDate(){
			var param = {};
			$.ajax({
				type: 'POST',
				dataType: 'json',
				contentType: "application/json;charset=UTF-8",
				url: configJson.loadZWURL.customerFormList,
				data: JSON.stringify(param),
				success: function (data) {
					$('.datatable-1').dataTable({
						"data": data,
						"bStateSave": true, //狀態保存
						"aoColumnDefs": [{
								"orderable": false,
								"aTargets": [0, 4]
							}  
						],
						"columns": [{
								"title": "表单名称",
								data: 'name'
							},
							{
								"title": "表单版本",
								data: 'version'
							},
							{
								"title": "配置时间",
								data: 'createDate'
							},
							{
								"title": "状态",
								data: 'state.title'
							},
							{
								"title": "操作",
								width: 200,
								data: 'formType',
								render: function (data, type, full, meta) {
									if ('UP' == full.formType) {
										return '<a class="btn btn-primary">编辑</a>&nbsp;&nbsp;<a class="btn " title="' +full.id + '" >设计</a>&nbsp;&nbsp;<a class="btn btn-danger">删除</a>';
									} else if ('UED' == full.formType) {
										return '<a class="btn btn-primary">编辑</a>&nbsp;&nbsp;<a class="btn btn-info design" title="' +full.id + '" type="'+full.formType+'" onclick="javascript:design(this)">设计</a>&nbsp;&nbsp;<a class="btn btn-danger">删除</a>';
									}
								}
							}
						],
						language: {
							"sProcessing": "处理中...",
							"sLengthMenu": "显示 _MENU_ 项结果",
							"sZeroRecords": "没有匹配结果",
							"sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
							"sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
							"sInfoFiltered": "(由 _MAX_ 项结果过滤)",
							"sInfoPostFix": "",
							"sSearch": "搜索:",
							"sUrl": "",
							"sEmptyTable": "表中数据为空",
							"sLoadingRecords": "载入中...",
							"sInfoThousands": ",",
							"oPaginate": {
								"sFirst": "首页",
								"sPrevious": "上页",
								"sNext": "下页",
								"sLast": "末页"
							},
							"oAria": {
								"sSortAscending": ": 以升序排列此列",
								"sSortDescending": ": 以降序排列此列"
							}
						}
					});
					$('.dataTables_paginate').addClass("btn-group datatable-pagination");
					$('.dataTables_paginate > a').wrapInner('<span />');
					$('.dataTables_paginate > a:first-child').append( '<i class="icon-chevron-left shaded"></i>');
					$('.dataTables_paginate > a:last-child').append( '<i class="icon-chevron-right shaded"></i>');
				}
			});
		}
		$(document).ready(function () {
			loadDate();
			$(".add").click(function(){
				$('#myModal').modal('show');
			});
			$(".submitCustFrom").click(function(event){
				var $name = $("#inputForm [name=name]");
				var $code = $("#inputForm [name=code]");
				if('' == $name.val()){
					$name.parent().find('.invalid-feedback').removeClass('hide');
					$name.parent().find('.invalid-feedback').css("color",'#bb5454');
					$name.css("border-color",'#bb5454');
					return ;
				}else{
					$name.parent().find('.invalid-feedback').addClass('hide');
					$name.css("border-color",'#cccccc');
				}
				if('' == $code.val()){
					$code.parent().find('.invalid-feedback').removeClass('hide');
					$code.parent().find('.invalid-feedback').css("color",'#bb5454');
					$code.css("border-color",'#bb5454');
					return ;
				}else{
					$code.parent().find('.invalid-feedback').addClass('hide');
					$code.css("border-color",'#cccccc');
				}
				var inputForm = {
					code:$("#inputForm [name=code]").val(),
					name:$("#inputForm [name=name]").val(),
					formType:$("#inputForm [name=formType]").val(),
					common:$("#inputForm [name=common]").val()
				}
				$.ajax({
					type: 'POST',
					dataType:'json',
					contentType: "application/json;charset=UTF-8",
					url: configJson.loadZWURL.insertCustomer,
					data:JSON.stringify(inputForm),
					success:function(data){
						if(data){
							if('A' == data.state.code){
								$('#myModal').modal('hide');
							}else{
								$("#inputForm .message").removeClass('hide')
								$("#inputForm .message").html('新增失败');
							}
						}else{
							$("#inputForm .message").removeClass('hide')
							$("#inputForm .message").html('新增失败');
						}
					}
				});
			});
		} );
		$(".nav>li").click(function(e){
			$(".nav>li").removeClass("active")
			$(this).addClass("active")
		})
	</script>
</body>